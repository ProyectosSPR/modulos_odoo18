<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_mx_reconcile_rule_test_wizard_form" model="ir.ui.view">
        <field name="name">mx.reconcile.rule.test.wizard.form</field>
        <field name="model">mx.reconcile.rule.test.wizard</field>
        <field name="arch" type="xml">
            <form string="Laboratorio de Conciliaci√≥n">
                <sheet>
                    <div class="oe_title">
                        <label for="rule_id"/>
                        <h1><field name="rule_id" readonly="1"/></h1>
                        <p class="text-muted">Experimente con diferentes configuraciones para ver qu√© coincide</p>
                    </div>

                    <group>
                        <group string="Per√≠odo">
                            <field name="date_from"/>
                            <field name="date_to"/>
                        </group>
                        <group string="Estad√≠sticas">
                            <field name="total_source"/>
                            <field name="total_target"/>
                            <field name="total_matches"/>
                            <field name="match_percentage" widget="progressbar"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="‚öôÔ∏è Configuraci√≥n" name="config">
                            <group>
                                <group string="¬øQu√© Comparar?">
                                    <field name="source_field"/>
                                    <field name="target_field"/>
                                    <field name="match_type"/>
                                </group>
                                <group string="Opciones">
                                    <field name="min_similarity" widget="progressbar"/>
                                    <field name="case_sensitive"/>
                                </group>
                            </group>

                            <group string="üîç Filtros (Opcional)">
                                <group>
                                    <label for="source_domain" string="Filtrar L√≠neas Bancarias"/>
                                    <field name="source_domain" nolabel="1" placeholder='Ejemplo: [("amount", ">", 1000)]'/>
                                    <div class="text-muted">
                                        <small>
                                            ‚Ä¢ Solo no conciliadas: [('is_reconciled', '=', False)]<br/>
                                            ‚Ä¢ Montos mayores: [('amount', '>', 1000)]<br/>
                                            ‚Ä¢ Con partner: [('partner_id', '!=', False)]
                                        </small>
                                    </div>
                                </group>
                                <group>
                                    <label for="target_domain" string="Filtrar Facturas"/>
                                    <field name="target_domain" nolabel="1" placeholder='Ejemplo: [("move_type", "=", "out_invoice")]'/>
                                    <div class="text-muted">
                                        <small>
                                            ‚Ä¢ Facturas cliente: [('move_type', '=', 'out_invoice')]<br/>
                                            ‚Ä¢ No pagadas: [('payment_state', '=', 'not_paid')]<br/>
                                            ‚Ä¢ Por monto: [('amount_total', '>', 5000)]
                                        </small>
                                    </div>
                                </group>
                            </group>
                        </page>

                        <page string="üìä Resultados" name="results">
                            <group invisible="total_source == 0">
                                <div class="alert alert-info" role="alert">
                                    <strong>üëâ Primero configure y haga clic en "Ejecutar Prueba"</strong>
                                </div>
                            </group>

                            <group invisible="total_source == 0 or total_matches > 0">
                                <div class="alert alert-warning" role="alert">
                                    <strong>‚ö†Ô∏è No se encontraron coincidencias</strong><br/>
                                    Se procesaron <field name="total_source" readonly="1" class="oe_inline"/> l√≠neas bancarias
                                    y <field name="total_target" readonly="1" class="oe_inline"/> facturas.<br/><br/>
                                    <strong>Intente:</strong><br/>
                                    ‚Ä¢ Cambiar el tipo de comparaci√≥n (ej: "Contiene" en lugar de "Igualdad Exacta")<br/>
                                    ‚Ä¢ Reducir la similitud m√≠nima<br/>
                                    ‚Ä¢ Cambiar los campos que se comparan<br/>
                                    ‚Ä¢ Ajustar el per√≠odo de fechas
                                </div>
                            </group>

                            <group invisible="total_matches == 0">
                                <div class="alert alert-success" role="alert">
                                    <strong>‚úÖ ¬°Se encontraron coincidencias!</strong><br/>
                                    <field name="total_matches" readonly="1" class="oe_inline"/> matches de
                                    <field name="total_source" readonly="1" class="oe_inline"/> l√≠neas
                                    (<field name="match_percentage" readonly="1" class="oe_inline"/>%)
                                </div>
                            </group>

                            <group invisible="total_matches == 0">
                                <button name="action_open_reconcile_view"
                                        string="üîç Ver en Vista de Conciliaci√≥n OCA"
                                        type="object"
                                        class="btn-primary btn-lg"
                                        icon="fa-eye"/>
                            </group>

                            <group string="Detalles de Coincidencias" invisible="total_matches == 0">
                                <field name="match_detail_ids" nolabel="1">
                                    <tree create="0" delete="0">
                                        <field name="line_date"/>
                                        <field name="line_ref"/>
                                        <field name="line_amount"/>
                                        <field name="source_value" string="Valor L√≠nea"/>
                                        <field name="match_score" widget="progressbar"/>
                                        <field name="invoice_name"/>
                                        <field name="invoice_amount"/>
                                        <field name="target_value" string="Valor Factura"/>
                                    </tree>
                                </field>
                            </group>
                        </page>
                    </notebook>

                    <footer>
                        <button name="action_test_rule"
                                string="‚ñ∂Ô∏è Ejecutar Prueba"
                                type="object"
                                class="btn-primary"/>
                        <button name="action_open_reconcile_view"
                                string="Vista OCA"
                                type="object"
                                class="btn-secondary"
                                invisible="total_matches == 0"/>
                        <button string="Cerrar" special="cancel" class="btn-secondary"/>
                    </footer>
                </sheet>
            </form>
        </field>
    </record>
</odoo>
