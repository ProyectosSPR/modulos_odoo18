<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">

        <record id="rule_exact_ref" model="mx.reconcile.rule">
            <field name="name">Match Exacto - Referencia</field>
            <field name="sequence">10</field>
            <field name="source_model">statement_line</field>
            <field name="source_field_id" ref="account.field_account_bank_statement_line__ref"/>
            <field name="target_model">invoice</field>
            <field name="target_field_id" ref="account.field_account_move__ref"/>
            <field name="match_type">equals</field>
            <field name="auto_reconcile">True</field>
            <field name="priority">high</field>
            <field name="min_similarity">100.0</field>
            <field name="description">Coincidencia exacta entre la referencia del pago y la referencia de la factura</field>
        </record>

        <record id="rule_uuid_in_narration" model="mx.reconcile.rule">
            <field name="name">UUID en Descripción</field>
            <field name="sequence">20</field>
            <field name="source_model">statement_line</field>
            <field name="source_field_id" ref="account.field_account_bank_statement_line__payment_ref"/>
            <field name="target_model">invoice</field>
            <field name="target_field_id" ref="l10n_mx_edi.field_account_move__l10n_mx_edi_cfdi_uuid"/>
            <field name="match_type">contains</field>
            <field name="auto_reconcile">True</field>
            <field name="priority">high</field>
            <field name="min_similarity">90.0</field>
            <field name="description">Busca el UUID fiscal en la descripción del pago</field>
        </record>

        <record id="rule_invoice_number" model="mx.reconcile.rule">
            <field name="name">Número de Factura en Referencia</field>
            <field name="sequence">30</field>
            <field name="source_model">statement_line</field>
            <field name="source_field_id" ref="account.field_account_bank_statement_line__payment_ref"/>
            <field name="target_model">invoice</field>
            <field name="target_field_id" ref="account.field_account_move__name"/>
            <field name="match_type">contains</field>
            <field name="auto_reconcile">False</field>
            <field name="require_manual_review">True</field>
            <field name="priority">medium</field>
            <field name="min_similarity">85.0</field>
            <field name="description">Busca el número de factura en la referencia del pago</field>
        </record>

        <record id="rule_partner_name" model="mx.reconcile.rule">
            <field name="name">Coincidencia por Cliente/Proveedor</field>
            <field name="sequence">40</field>
            <field name="source_model">statement_line</field>
            <field name="source_field_id" ref="account.field_account_bank_statement_line__partner_id"/>
            <field name="target_model">invoice</field>
            <field name="target_field_id" ref="account.field_account_move__partner_id"/>
            <field name="match_type">equals</field> <field name="auto_reconcile">False</field>
            <field name="require_manual_review">True</field>
            <field name="priority">low</field>
            <field name="min_similarity">100.0</field>
            <field name="description">Coincidencia por Cliente/Proveedor (requiere revisión)</field>
        </record>

        <record id="relation_rule_sale_order" model="mx.reconcile.relation.rule">
            <field name="name">Buscar por Orden de Venta</field>
            <field name="sequence">10</field>
            <field name="payment_field_id" ref="account.field_account_bank_statement_line__payment_ref"/>
            <field name="relation_model">sale.order</field>
            <field name="relation_search_field_id" ref="sale.field_sale_order__name"/>
            <field name="invoice_relation_field_id" ref="sale.field_sale_order__invoice_ids"/>
            <field name="search_type">contains</field>
            <field name="extract_pattern">([A-Z]{2,4}\d{5,})</field>
            <field name="auto_reconcile">False</field>
            <field name="priority">medium</field>
            <field name="description">Extrae el número de orden de venta (ej: SO12345) y busca sus facturas relacionadas</field>
        </record>

        <record id="relation_rule_sale_client_ref" model="mx.reconcile.relation.rule">
            <field name="name">Buscar por Referencia del Cliente</field>
            <field name="sequence">20</field>
            <field name="payment_field_id" ref="account.field_account_bank_statement_line__payment_ref"/>
            <field name="relation_model">sale.order</field>
            <field name="relation_search_field_id" ref="sale.field_sale_order__client_order_ref"/>
            <field name="invoice_relation_field_id" ref="sale.field_sale_order__invoice_ids"/>
            <field name="search_type">contains</field>
            <field name="extract_pattern">(\d{6,})</field>
            <field name="auto_reconcile">False</field>
            <field name="priority">medium</field>
            <field name="description">Busca la referencia del cliente en órdenes de venta (números de 6+ dígitos)</field>
        </record>

        <record id="relation_rule_purchase_order" model="mx.reconcile.relation.rule">
            <field name="name">Buscar por Orden de Compra</field>
            <field name="sequence">30</field>
            <field name="payment_field_id" ref="account.field_account_bank_statement_line__payment_ref"/>
            <field name="relation_model">purchase.order</field>
            <field name="relation_search_field_id" ref="purchase.field_purchase_order__name"/>
            <field name="invoice_relation_field_id" ref="purchase.field_purchase_order__invoice_ids"/>
            <field name="search_type">contains</field>
            <field name="extract_pattern">([A-Z]{2,4}\d{5,})</field>
            <field name="auto_reconcile">False</field>
            <field name="priority">medium</field>
            <field name="description">Extrae el número de orden de compra y busca sus facturas relacionadas</field>
        </record>

        <record id="relation_rule_purchase_partner_ref" model="mx.reconcile.relation.rule">
            <field name="name">Buscar por Referencia del Proveedor</field>
            <field name="sequence">40</field>
            <field name="payment_field_id" ref="account.field_account_bank_statement_line__payment_ref"/>
            <field name="relation_model">purchase.order</field>
            <field name="relation_search_field_id" ref="purchase.field_purchase_order__partner_ref"/>
            <field name="invoice_relation_field_id" ref="purchase.field_purchase_order__invoice_ids"/>
            <field name="search_type">contains</field>
            <field name="auto_reconcile">False</field>
            <field name="priority">low</field>
            <field name="description">Busca la referencia del proveedor en órdenes de compra</field>
        </record>

    </data>
</odoo>