<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="action_server_list" model="ir.ui.view">
        <field name="name">ir.actions.server.list</field>
        <field name="model">ir.actions.server</field>
        <field name="arch" type="xml">
            <list>
                <field name="name" />
                <field name="state" />
                <field name="model_id" />
            </list>
        </field>
    </record>

    <record id="view_server_action_form" model="ir.ui.view">
        <field name="name">ir.actions.server.form.inherit.ai</field>
        <field name="model">ir.actions.server</field>
        <field name="inherit_id" ref="base.view_server_action_form" />
        <field name="arch" type="xml">
            <group name="action_content" position="inside">
                <field
                    name="ai_model_id"
                    required="state == 'generative_ai'"
                    invisible="state != 'generative_ai'"
                />
                <field name="include_report_id" invisible="state != 'generative_ai'" />
                <field
                    name="include_all_attachments"
                    invisible="state != 'generative_ai'"
                />
                <field name="include_chatter" invisible="state != 'generative_ai'" />
                <field
                    name="include_full_object_data"
                    invisible="state != 'generative_ai'"
                />
                <field name="output_destination" invisible="state != 'generative_ai'" />
                <field
                    name="output_field_id"
                    invisible="output_destination != 'field'"
                    required="output_destination == 'field'"
                />
                <field
                    name="output_activity_type_id"
                    invisible="output_destination != 'activity'"
                    required="output_destination == 'activity'"
                />
                <field
                    name="output_activity_user_id"
                    invisible="output_destination != 'activity'"
                    required="output_destination == 'activity'"
                />
                <div
                    id="warning_message"
                    class="alert alert-warning text-center"
                    role="alert"
                    colspan="2"
                    invisible="output_destination != 'field'"
                >
                    <p class="my-0">
                        <i
                            class="fa fa-warning"
                        /> Updating a field will overwrite the current content of that field.
                    </p>
                </div>
            </group>
            <group name="action_wrapper" position="after">
                <notebook invisible="state != 'generative_ai'">
                    <page name="prompt_template" string="Prompt Template">
                        <field
                            name="prompt_template"
                            required="state == 'generative_ai'"
                        />
                        <button
                            name="action_preview_prompt"
                            type="object"
                            string="Preview Prompt"
                            class="mt-5 btn-secondary"
                        />
                    </page>
                </notebook>
            </group>
        </field>
    </record>

    <record id="view_server_action_search" model="ir.ui.view">
        <field name="name">ir.actions.server.search</field>
        <field name="model">ir.actions.server</field>
        <field name="inherit_id" ref="base.view_server_action_search" />
        <field name="arch" type="xml">
            <field name="state" position="after">
                <separator />
                <filter
                    string="Generative AI"
                    name="generative_ai"
                    domain="[('state', '=', 'generative_ai')]"
                />
                <separator />
            </field>
        </field>
    </record>

    <record id="action_server_window" model="ir.actions.act_window">
        <field name="name">Server Actions</field>
        <field name="res_model">ir.actions.server</field>
        <field name="view_mode">list,form</field>
        <field name="view_id" ref="much_automated_agent_actions.action_server_list" />
        <field name="search_view_id" ref="base.view_server_action_search" />
        <field
            name="context"
        >{'key': 'server_action', 'search_default_generative_ai': True}</field>
    </record>

    <menuitem
        action="action_server_window"
        id="server_action_menu"
        parent="ai_actions_menu"
        sequence="20"
    />
</odoo>
